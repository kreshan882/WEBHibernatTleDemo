
============================== 2017/12/27 ======================================
=============================== added by gayan =================================

1).Password History Table

CREATE TABLE `EPIC_TLE_USER_PASSWORD_HISTORY` (
  `PASSWORD_HISTORY_ID` int(10) NOT NULL AUTO_INCREMENT,
  `PREVIOUS_PASSWORD` varchar(255) DEFAULT NULL,
  `USERID` int(11) DEFAULT NULL,
  `CERATED_DATE` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`PASSWORD_HISTORY_ID`),
  KEY `USERID` (`USERID`),
  CONSTRAINT `USERID` FOREIGN KEY (`USERID`) REFERENCES `EPIC_TLE_USER`
 (`USERID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=17 DEFAULT CHARSET=latin1;
SET FOREIGN_KEY_CHECKS=1;

/////////////////////////////////////////////////////////////////////////////////////////////////////////

2).Changes of EpicTleUser table 
    i).Add lastRawUpdatedDateTime colum
       ALTER TABLE EPIC_TLE_USER ADD LR_UPDATED_TIMESTAMP TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP 
    
    ii).Add failureLoginAttempts colum 
        ALTER TABLE EPIC_TLE_USER ADD FAILURE_LOGIN_COUNT int NULL DEFAULT 0 
    
    iii).Add LastPasswordChangeDateTime colum
        ALTER TABLE EPIC_TLE_USER ADD L_PASS_CHANGE_DATE TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP 

    iv).Add userEmail colum
        ALTER TABLE EPIC_TLE_USER ADD EMAIL VARCHAR(255) NULL DEFAULT NULL 

/////////////////////////////////////////////////////////////////////////////////////////////////////////

3). Insert 'Send' Task to TleTask table (if not exists) and TaskId should be 12
    i).INSERT INTO EPIC_TLE_TASK VALUES (12, 'Send');

/////////////////////////////////////////////////////////////////////////////////////////////////////////

4). Insert 'Locked' Status and 'Waiting For Password' status to TleStatus table (Status code should be 8 and 9) 
    i).INSERT INTO EPIC_TLE_STATUS VALUES (8, 'Locked');
    i).INSERT INTO EPIC_TLE_STATUS VALUES (9, 'Waiting For Password');

///////////////////////////////////////////////////////////////////////////////////////////////////////////

5).Chnages of InitConfig table

    i).Add Password attempts count column
       ALTER TABLE EPIC_TLE_INITCONFIG ADD NUM_OF_PASS_ATTEMPTS INT NULL DEFAULT 3;

    ii).Add Password Expiration time period column
       ALTER TABLE EPIC_TLE_INITCONFIG ADD USR_PASS_EXP_TIME VARCHAR(800) NULL DEFAULT '90';
    
    iii).Add User Account lock time column
       ALTER TABLE EPIC_TLE_INITCONFIG ADD USER_ACCOUNT_LOCK_TIME INT NULL DEFAULT 30;


============================== 2017/12/28 ======================================
=============================== added by Sudesh =================================
1).Chnages of History table

    i).Add section column
        ALTER TABLE EPIC_TLE_HISTORY ADD SECTION VARCHAR(4);

    ii).Add old value column
        ALTER TABLE EPIC_TLE_HISTORY ADD OLD_VALUE TEXT NULL;

    ii).Add new value column
        ALTER TABLE EPIC_TLE_HISTORY ADD NEW_VALUE TEXT NULL;


============================== 2018/01/03 ======================================
=============================== added by Sudesh =================================

1).Chnages of USER table

    i). Change the length of Password Column 
        ALTER TABLE EPIC_TLE_USER MODIFY `PASSWORD` VARCHAR(250);


======================================2017-12-20 ================================
================================added by gayan=======================================

1).Add Reset task to task table
    i).INSERT INTO EPIC_TLE_TASK VALUES (13, 'Reset');

2).add new status Forget to status table
    i).INSERT INTO EPIC_TLE_STATUS VALUES (10, 'Forget');

3).add lastPsswordresettime column to user table
    i).ALTER TABLE EPIC_TLE_USER ADD L_PASS_RESET_DATE TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP 


======================================2018-01-03 ================================
================================added by gayan=======================================

1).Add Email template to config table
    i).ALTER TABLE EPIC_TLE_INITCONFIG ADD PASS_RESET_MAIL_TEMPLATE TEXT NULL;
    
    ii).UPDATE EPIC_TLE_INITCONFIG SET PASS_RESET_MAIL_TEMPLATE = 'Epic|TLE - User Password Reset@<html><body><div class="main-mail" style="font-family: sans-serif;background-color: #ffffff;padding: 15px;margin: 15px; box-shadow: 0px 0px 6px 2px rgba(96, 125, 139, 0.33), inset 0px -10px 0 #607D8B;width: 50%;"><div><img width="150" height="50" src="https://lh3.googleusercontent.com/03LUh4yw9BcEPEPOlI37geI7Oia9XPyxx9ly8Ggxv48WD4kyvuJeD2Q2fiYspQnmzfN1SS1SPNaBBYi0fwGPb6J8ERfaPUEfzPlwJUsmZRXw0TT3iYoMfZhLlEzbm22a97vD39mxkxweJK2t5W8dYKY91dndy0qe-iA_nu7VcPZN2TMAtuXI4UaWu_zCYd5tyHe6j0T5Wc3MqJtvsnC3GqHH3EJLZhZ5tkwHsFrKGeZXXRWG3lnSwBTqd2xjKvZXGeivVAct8fidjM9qXiBJzm7Bwz6AWh2Xe41hjfyLsiFtu8QSW3_S0Zk-J4wBw_WVOZGZhbZXUZ3VVHgwkBOjFD0Bt-RTo0lAV_eaZGu--LLYcxdKjqyivmlHSTO5tFDLdhQ6hqtOC2s1ER_dywkWDaI1mbS3l2FwwYj-4X2DLufrAvUywelrIjP8Cci87VRVmNRkOZ0VyGyO5vZuroSYXG0TBZedJk9jesQe_tf3DLeCIFvU9hm0lLtykAHxJVZacu1Dv1RLMuE7ALh7Xhn4OXdFJTZ5iv-3dH5cthWJypNho7L8Cxq6iI2nbZkKZEIY=w1366-h596" /> </div><br><div class="header-mail" style="border-bottom: 1px solid gray;padding-bottom: 9px;color: #607D8B;font-size: 15px;font-weight: 600;">Dear <span>[username]</span></div><div class="content-mail"><div class="topCont-mail"><p>Its to inform that administrator has rest the password.</p></div><div class="passowrd-mail"><p style="font-weight:bold;">your temporolly password - <span style="font-weight: bold;color: #ffffff;background-color: #009688;padding: 5px;">[tempassword]</span></p></div><div class="bottom-mail" style="font-size:12px;color:red"><p>Note : This temporary password will be expired within <label style="font-weight:bold">[EXPTIME] hr</label>.<br> If any concern, please contact the administrator for further support.</p></div></div><div class="footer-mail"><p style="border-top: 1px solid gray; padding-top: 9px; color: #607D8B;font-size:15px;font-weight: 600;">Regards,</p></div></div></body></html>';

iii).ALTER TABLE EPIC_TLE_INITCONFIG ADD EMAIL_GW_PORT INT NULL DEFAULT 25;

2) Add temp password expiratrion time to config table
    i).ALTER TABLE EPIC_TLE_INITCONFIG ADD USR_TMP_PASS_EXP_TIME INT NULL DEFAULT 24


3).INSERT INTO EPIC_TLE_SECTION_TASK VALUES ('0101', 13);


==============2018-01-04=======================================
1).Remove unwanted table
    DROP TABLE EPIC_TLE_FOUNDNIISTATUS;

1).Remove unwanted table
    DROP TABLE EPIC_TLE_SYS_BLOCK_BIN;

=================copied(gayan) from oracle_changes(added by sudesh) 2018-01-19===================

RENAME TABLE EPIC_TLE_CHANNEL_OPERATION_METHOD TO EPIC_TLE_CHANNEL_OPR_METHOD ;

ALTER TABLE EPIC_TLE_INITCONFIG DROP COLUMN HSM_SLOT;
ALTER TABLE EPIC_TLE_INITCONFIG DROP COLUMN HSM_KEY_UTILITY_VERSION;
ALTER TABLE EPIC_TLE_INITCONFIG DROP COLUMN PSGPASSWORD;

RENAME TABLE EPIC_TLE_TERMINAL_REFPROFILE TO EPIC_TLE_TERMINAL_RISK_PROFILE;


ALTER TABLE EPIC_TLE_TERMINAL CHANGE ETMKSESSIONKEY ETMK varchar(48) CHARACTER SET latin1 COLLATE latin1_general_ci DEFAULT '10101010101010101010101010101010' NULL;
ALTER TABLE EPIC_TLE_TERMINAL CHANGE EMKESESSIONKEY EMEK varchar(48) CHARACTER SET latin1 COLLATE latin1_general_ci DEFAULT '10101010101010101010101010101010' NULL ;
ALTER TABLE EPIC_TLE_TERMINAL CHANGE REF_PROFILE_NUM RISK_PROFILE_ID int(2) DEFAULT 1 NOT NULL ;


ALTER TABLE EPIC_TLE_USER ADD CONSTRAINT EMAIL UNIQUE KEY (EMAIL) ;



ALTER TABLE EPIC_TLE_USER ADD RAND_VAL VARCHAR(50) NOT NULL DEFAULT '313D94DDA020D2BE5F4C02E5C0B29368';


======================================2018-02-13 ================================
================================added by ridmi=======================================
1. add new tables
CREATE TABLE `EPIC_TLE_SMS_PROFILE` (
    `SMS_PROFILE_ID` int(10) NOT NULL AUTO_INCREMENT,
    `PROFILE_NAME` varchar(50) DEFAULT NULL,
    `STATUS` int(1) NOT NULL,
    `CERATED_DATE` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`SMS_PROFILE_ID`),
    FOREIGN KEY (`STATUS`) REFERENCES `EPIC_TLE_STATUS`
    (`CODE`) ON DELETE CASCADE ON UPDATE CASCADE
    ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;
    SET FOREIGN_KEY_CHECKS=1;

CREATE TABLE `EPIC_TLE_SMS_PROFILE_INFO` (
    `ID` int(10) NOT NULL AUTO_INCREMENT,
    `PROFILE_ID` int(10) NOT NULL,
    `MOBILE_NO` varchar(15) DEFAULT NULL,
    `EMAIL` varchar(100) DEFAULT NULL,
    `CERATED_DATE` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`ID`),
    FOREIGN KEY (`PROFILE_ID`) REFERENCES `EPIC_TLE_SMS_PROFILE`
    (`SMS_PROFILE_ID`) ON DELETE CASCADE ON UPDATE CASCADE
    ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;
    SET FOREIGN_KEY_CHECKS=1;

2. insert data to epic_tle_section table
        insert into EPIC_TLE_SECTION values ('0606','06','SMS Profile','smsProf');

3. insert data to epic_tle_section_task table
      INSERT INTO EPIC_TLE_SECTION_TASK VALUES ('0606', '01');
      INSERT INTO EPIC_TLE_SECTION_TASK VALUES ('0606', '02');
      INSERT INTO EPIC_TLE_SECTION_TASK VALUES ('0606', '03');
      INSERT INTO EPIC_TLE_SECTION_TASK VALUES ('0606', '04');

4. create new table 
        CREATE TABLE `EPIC_TLE_SMS_FILTER` (
        `ID` int(10) NOT NULL AUTO_INCREMENT,
        `PROFILE_ID` int(10) NOT NULL,
	`MESSAGE` varchar(250) DEFAULT NULL,
        `CERATED_DATE` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
	 PRIMARY KEY (`ID`),
         FOREIGN KEY (`PROFILE_ID`) REFERENCES `EPIC_TLE_SMS_PROFILE`
        (`SMS_PROFILE_ID`) ON DELETE CASCADE ON UPDATE CASCADE
        ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;
        SET FOREIGN_KEY_CHECKS=1;
    
//////////////////adde by gayan //////////////////////////////

#ALTER TABLE EPIC_TLE_BLOCK_BIN DROP BIN; // dont use
#ALTER TABLE EPIC_TLE_BLOCK_BIN ADD LOW_VALUE INT NOT NULL; //dont user
#ALTER TABLE EPIC_TLE_BLOCK_BIN ADD UPPER_VALUE INT NOT NULL; //dont user


DROP TABLE EPIC_TLE_BLOCK_BIN;
CREATE TABLE EPIC_TLE_BLOCK_BIN
(
  PROFILE_ID INT DEFAULT '6'                     NOT NULL,
  LOW_VALUE   INT                                 NOT NULL,
  UPPER_VALUE INT                                 NOT NULL,
  DATETIME   TIMESTAMP DEFAULT CURRENT_TIMESTAMP NULL,
  PRIMARY KEY (PROFILE_ID, LOW_VALUE,UPPER_VALUE),
  CONSTRAINT FK_EPIC_TLE_BLOCK_BIN_EPIC_TLE_BIN_PROFILE
  FOREIGN KEY (PROFILE_ID) REFERENCES EPIC_TLE_BIN_PROFILE (ID)
);


#ALTER TABLE EPIC_TLE_LOCALBIN ADD CATEGORY_CODE NUMBER DEFAULT 0;

DROP TABLE EPIC_TLE_LOCALBIN;

CREATE TABLE EPIC_TLE_LOCALBIN
(
BIN VARCHAR(6) NOT NULL,
TIMESTAMP TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
CATEGORY_CODE INT NOT NULL,
PRIMARY KEY (BIN, CATEGORY_CODE)
);

update EPIC_TLE_LOCALBIN set CATEGORY_CODE=1;

======================================2018-02-26 ================================
================================added by ridmi=======================================
ALTER TABLE EPIC_TLE_INITCONFIG
ADD SMS_PORT int;

======================================2018-02-27================================
================================added by ridmi=======================================
1. drop SMS_GW_URL column from EPIC_TLE_INITCONFIG table
    ALTER TABLE EPIC_TLE_INITCONFIG
    DROP COLUMN SMS_GW_URL;

 2. Update Local Bin to Bank Bin 
     UPDATE EPIC_TLE_SECTION
    SET SECTION_NAME = 'Bank BIN'
    WHERE SECTION_ID = '0904';

3. Update SMS Profile to Alert Group Profile
UPDATE EPIC_TLE_SECTION
SET SECTION_NAME = 'Alert Group Profile'
WHERE SECTION_ID = '0606';

